{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/reactive.ts"],
  "sourcesContent": ["// src/index.ts\nexport { reactive } from './reactive'\nexport { effect } from './effect'", "// src/index.ts\n\n/**\n * \u5224\u65AD\u5BF9\u8C61\n */\nexport const isObject = (value: unknown) => {\n  return typeof value === 'object' && value !== null\n}\n\n/**\n * \u5224\u65AD\u5B57\u7B26\u4E32\n */\nexport const isString = (value: unknown) => {\n  return typeof value === 'string'\n}\n\n/**\n * \u5224\u65AD\u6570\u5B57\n */\nexport const isNumber = (value: unknown) => {\n  return typeof value === 'number'\n}\n\n/**\n * \u5224\u65AD\u6570\u7EC4\n */\nexport const isArray = Array.isArray", "// reactivity/src/effect.ts\n\nexport let activeEffect\n\nexport function effect(fn) {\n  const _effect = new ReactiveEffect(fn)\n\n  _effect.run()\n}\n\nclass ReactiveEffect {\n  constructor(fn) {\n    this.fn = fn\n  }\n\n  run() {\n    // \u5C06 _effect \u8D4B\u7ED9\u5168\u5C40\u7684\u53D8\u91CF activeEffect\n    activeEffect = this\n    // fn \u6267\u884C\u65F6, \u5185\u90E8\u7528\u5230\u7684\u54CD\u5E94\u5F0F\u6570\u636E\u7684\u5C5E\u6027\u4F1A\u88AB\u8BBF\u95EE\u5230, \u5C31\u80FD\u89E6\u53D1 proxy \u5BF9\u8C61\u7684 get \u53D6\u503C\u64CD\u4F5C\n    this.fn()\n  }\n}\n\n// \u5B58\u50A8\u6240\u6709\u7684\u4F9D\u8D56\u4FE1\u606F, \u5305\u542B target, key \u548C _effect\nconst targetMap = new WeakMap()\n/**\n * \u4F9D\u8D56\u6536\u96C6\n */\nexport function track(target, key) {\n  if (!activeEffect) return\n\n  // \u4ECE\u7F13\u5B58\u4E2D\u627E\u5230 target \u5BF9\u8C61\u6240\u6709\u7684\u4F9D\u8D56\u4FE1\u606F\n  let depsMap = targetMap.get(target)\n\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()))\n  }\n\n  // \u518D\u627E\u5230\u5C5E\u6027 key \u6240\u5BF9\u5E94\u7684 _effect \u96C6\u5408\n  let deps = depsMap.get(key)\n\n  if (!deps) {\n    depsMap.set(key, (deps = new Set()))\n  }\n\n  // \u5982\u679C _effect \u5DF2\u7ECF\u88AB\u6536\u96C6\u8FC7\u4E86, \u5219\u4E0D\u518D\u6536\u96C6\n  let shouldTrack = !deps.has(activeEffect)\n\n  if (shouldTrack) {\n    deps.add(activeEffect)\n  }\n}\n\n/**\n * \u6D3E\u53D1\u673A\u5236\n */\nexport function trigger(target, key) {\n  // \u627E\u5230 target \u7684\u6240\u6709\u8D44\u6E90\n  let depsMap = targetMap.get(target)\n\n  if (!depsMap) return\n\n  // \u5C5E\u6027\u4F9D\u8D56\u7684 _effect \u5217\u8868\n  let effects = depsMap.get(key)\n\n  if (effects) {\n    effects.forEach((effect) => {\n      effect.run()\n    })\n  }\n}\n", "// reactivity/src/reactive.ts\n\nimport { isObject } from '@mini-vue3/shared'\nimport { track, trigger } from './effect'\n\nconst enum ReactiveFlags {\n  IS_REACTIVE = '__v_isReactive',\n}\n\n// \u7F13\u5B58\u54CD\u5E94\u5F0F\u5BF9\u8C61\nconst reactiveMap = new WeakMap()\n\nexport function reactive(target: object) {\n  // \u5224\u65AD target \u662F\u5426\u662F\u54CD\u5E94\u5F0F\u5BF9\u8C61\n  // \u6BCF\u5F53\u4E00\u4E2A target \u9700\u8981\u54CD\u5E94\u5F0F, \u5148\u5224\u65AD\u5176\u6709\u6CA1\u6709\u8BE5\u5C5E\u6027, \u6B64\u65F6\u4EA7\u751F\u5C5E\u6027\u8BBF\u95EE\u64CD\u4F5C, \u5982\u679C target \u88AB\u4EE3\u7406\u8FC7, \u5219\u4F1A\u8FDB\u5165\u4E0B\u9762\u7684 get \u65B9\u6CD5\u4E2D, \u505A\u8FDB\u4E00\u6B65\u5224\u65AD\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target\n  }\n\n  // \u53EA\u80FD\u4EE3\u7406\u5BF9\u8C61\n  if (!isObject(target)) return target\n\n  // \u5224\u65AD target \u662F\u5426\u88AB\u4EE3\u7406\u8FC7, \u5982\u679C\u88AB\u4EE3\u7406\u8FC7, \u5219\u76F4\u63A5\u8FD4\u56DE\u4EE3\u7406\u5BF9\u8C61\n  const existing = reactiveMap.get(target)\n\n  if (existing) {\n    return existing\n  }\n\n  const handler = {\n    // \u76D1\u542C\u5C5E\u6027\u8BBF\u95EE\u64CD\u4F5C\n    get(target, key, receiver) {\n      if (key === ReactiveFlags.IS_REACTIVE) {\n        // \u8FD4\u56DE\u8BBE\u7F6E '__v_isReactive' \u7684\u503C\n        return true\n      }\n      console.log(`=== ${key} \u5C5E\u6027\u88AB\u8BBF\u95EE, \u4F9D\u8D56\u6536\u96C6 ===`)\n\n      // \u4F9D\u8D56\u6536\u96C6, \u8BA9 target, key \u548C\u5F53\u524D\u7684 _effect \u5173\u8054\u8D77\u6765\n      track(target, key)\n\n      const res = Reflect.get(target, key)\n\n      if (isObject(res)) {\n        return reactive(res)\n      }\n\n      return res\n    },\n    // \u76D1\u542C\u8BBE\u7F6E\u5C5E\u6027\u64CD\u4F5C\n    set(target, key, value, receiver) {\n      console.log(`${key}\u5C5E\u6027\u53D8\u5316\u4E86, \u6D3E\u53D1\u66F4\u65B0`)\n      if (target[key] !== value) {\n        const result = Reflect.set(target, key, value, receiver)\n\n        // \u6D3E\u53D1\u66F4\u65B0, \u901A\u77E5 target \u7684\u5C5E\u6027, \u8BA9\u4F9D\u8D56\u5B83\u7684 _effect \u518D\u6B21\u6267\u884C\n        trigger(target, key)\n        \n        return result\n      }\n    },\n  }\n\n  // \u5B9E\u4F8B\u5316\u4EE3\u7406\u5BF9\u8C61\n  const proxy = new Proxy(target, handler)\n\n  // \u5C06\u4EE3\u7406\u5BF9\u8C61\u8FDB\u884C\u7F13\u5B58\n  reactiveMap.set(target, proxy)\n\n  return proxy\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACKO,MAAM,WAAW,CAAC,UAAmB;AAC1C,WAAO,OAAO,UAAU,YAAY,UAAU;AAAA,EAChD;AAmBO,MAAM,UAAU,MAAM;;;ACxBtB,MAAI;AAEJ,WAAS,OAAO,IAAI;AACzB,UAAM,UAAU,IAAI,eAAe,EAAE;AAErC,YAAQ,IAAI;AAAA,EACd;AAEA,MAAM,iBAAN,MAAqB;AAAA,IACnB,YAAY,IAAI;AACd,WAAK,KAAK;AAAA,IACZ;AAAA,IAEA,MAAM;AAEJ,qBAAe;AAEf,WAAK,GAAG;AAAA,IACV;AAAA,EACF;AAGA,MAAM,YAAY,oBAAI,QAAQ;AAIvB,WAAS,MAAM,QAAQ,KAAK;AACjC,QAAI,CAAC;AAAc;AAGnB,QAAI,UAAU,UAAU,IAAI,MAAM;AAElC,QAAI,CAAC,SAAS;AACZ,gBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,IAC7C;AAGA,QAAI,OAAO,QAAQ,IAAI,GAAG;AAE1B,QAAI,CAAC,MAAM;AACT,cAAQ,IAAI,KAAM,OAAO,oBAAI,IAAI,CAAE;AAAA,IACrC;AAGA,QAAI,cAAc,CAAC,KAAK,IAAI,YAAY;AAExC,QAAI,aAAa;AACf,WAAK,IAAI,YAAY;AAAA,IACvB;AAAA,EACF;AAKO,WAAS,QAAQ,QAAQ,KAAK;AAEnC,QAAI,UAAU,UAAU,IAAI,MAAM;AAElC,QAAI,CAAC;AAAS;AAGd,QAAI,UAAU,QAAQ,IAAI,GAAG;AAE7B,QAAI,SAAS;AACX,cAAQ,QAAQ,CAACA,YAAW;AAC1B,QAAAA,QAAO,IAAI;AAAA,MACb,CAAC;AAAA,IACH;AAAA,EACF;;;AC5DA,MAAM,cAAc,oBAAI,QAAQ;AAEzB,WAAS,SAAS,QAAgB;AAGvC,QAAI,OAAO,kCAAyB,GAAG;AACrC,aAAO;AAAA,IACT;AAGA,QAAI,CAAC,SAAS,MAAM;AAAG,aAAO;AAG9B,UAAM,WAAW,YAAY,IAAI,MAAM;AAEvC,QAAI,UAAU;AACZ,aAAO;AAAA,IACT;AAEA,UAAM,UAAU;AAAA;AAAA,MAEd,IAAIC,SAAQ,KAAK,UAAU;AACzB,YAAI,QAAQ,oCAA2B;AAErC,iBAAO;AAAA,QACT;AACA,gBAAQ,IAAI,OAAO,kEAAqB;AAGxC,cAAMA,SAAQ,GAAG;AAEjB,cAAM,MAAM,QAAQ,IAAIA,SAAQ,GAAG;AAEnC,YAAI,SAAS,GAAG,GAAG;AACjB,iBAAO,SAAS,GAAG;AAAA,QACrB;AAEA,eAAO;AAAA,MACT;AAAA;AAAA,MAEA,IAAIA,SAAQ,KAAK,OAAO,UAAU;AAChC,gBAAQ,IAAI,GAAG,6DAAgB;AAC/B,YAAIA,QAAO,GAAG,MAAM,OAAO;AACzB,gBAAM,SAAS,QAAQ,IAAIA,SAAQ,KAAK,OAAO,QAAQ;AAGvD,kBAAQA,SAAQ,GAAG;AAEnB,iBAAO;AAAA,QACT;AAAA,MACF;AAAA,IACF;AAGA,UAAM,QAAQ,IAAI,MAAM,QAAQ,OAAO;AAGvC,gBAAY,IAAI,QAAQ,KAAK;AAE7B,WAAO;AAAA,EACT;",
  "names": ["effect", "target"]
}
